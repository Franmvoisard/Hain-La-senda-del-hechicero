//Librerías
#include "I2Cdev.h"
#include <IRremote.h>
#include <SoftwareSerial.h>
#include <DFPlayer_Mini_Mp3.h>
#include "MPU6050.h"
#include "Wire.h"

unsigned long int _ahora = 0;
unsigned long int _ultimo = 0;

const byte Motorbase = 5;
const byte Motormedio = 6;

int _vibracionActualMB = 0;
int _vibracionActualMM = 0;
int _ultimaVibracionMB = 0;
int _ultimaVibracionMM = 0;
bool _vibrando = false;


      int IRpin = 3;  //Sensor infrarrojo en el pin 3
      IRrecv irrecv(IRpin);  
      decode_results results;



SoftwareSerial mySerial(4, 7); //Iniciar la transmisión de datos para el MP3 RX, TX

void setup{
  irrecv.enableIRIn();

pinMode(Motorbase, LOW);
pinMode(Motormedio, LOW);

}

void loop {
      ActualizarMotores();
      }
void ActualizarMotores(){
           if (_vibrando==true){
            analogWrite(Motorbase,_vibracionActualMB);
            analogWrite(Motormedio,_vibracionActualMM);
      }
}

void receiveIR() {
  // Aca el llamado a la funcion que lee el IR, te guardas el valor en cmd para saber para donde switchear
  if (irrecv.decode(&results)){
  int cmd = results.value;
  Serial.print(cmd);
  switch(cmd){
    case 2064:
      ActivarMotor("Motorbase",0,255,300,1);
      break;
    case 2065:
      ActivarMotor("Motorbase",0,255,3000,5);
      break;
    case 2080:
      ActivarMotor("Motorbase",0,255,300,3);
      break;
    
  }
  irrecv.resume();
}
}

void ActivarMotor(motor,inicio,fin,duracion,veces){ // Definir los parámetros básicos que afectaran al sistema compuesto por los motores
   _ultimo = millis();
   _vibrando = true;    //Levantar un flag de activación
   _ultimaVibracionMB = _vibracionActualMB;
   _ultimaVibracionMM = _vibracionActualMM;
   _tiempotrans = duracion; //Pasar el valor de la variable a global
   _ahora = millis();   //Setear _ahora equivalente a la duración en ms actuales desde que el procesador se inició
   _indice = floor(duracion/(_ahora - _ultimo)) // Obtener la fracción de la transición  //5000 /(10000 - 0)
      if (motor == "Motorbase") {
            _vibracionActualMB = ((fin - _ultimaVibracionMB) / _indice) + _ultimaVibracionMB;
      }
   }
}
